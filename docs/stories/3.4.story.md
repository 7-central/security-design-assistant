# Story 3.4: AWS and GitHub Account Setup

## Status
Approved

## Story
**As a** DevOps engineer,  
**I want** properly configured AWS and GitHub accounts for the project,  
**so that** we can deploy and manage the Security Design Assistant infrastructure.

## Acceptance Criteria
1. AWS account configuration completed:
   - New AWS CLI profile `design-lee` created using existing `lee-hayton` IAM user for local development
   - New AWS CLI profile `design` created using existing `7c-IAM-Admin-User` for CI/CD deployments
   - S3 deployment bucket created for SAM artifacts in eu-west-2
   - Cost tracking tags configured for the project
2. GitHub repository structure established:
   - Investigate Ric's GitHub account for optimal organization structure
   - Create 7Central organization or use existing structure
   - Create design-assistant repository with proper settings
   - Configure repository access for development workflow
3. Local development workflow configured:
   - Lee's local git configured to push to Ric's repository
   - AWS CLI profile `design-lee` working locally
   - Test deployment permissions with simple SAM app
4. Documentation created:
   - AWS account setup documented
   - GitHub repository structure documented
   - Local development workflow documented
   - Credentials and access management documented

## Tasks / Subtasks
- [x] Investigate Current AWS Setup (AC: 1)
  - [x] Check existing AWS profiles on local system
  - [x] Verify access with `argan-lee` profile to AWS account
  - [x] Document current AWS account ID and region
  - [x] Review existing resources and billing setup
- [x] Create AWS Profile Configuration (AC: 1)
  - [x] Configure local AWS CLI profile `design-lee` using existing `lee-hayton` IAM user
  - [x] Configure local AWS CLI profile `design` using existing `7c-IAM-Admin-User`
  - [x] Test profile access with `aws sts get-caller-identity --profile design-lee`
  - [x] Test profile access with `aws sts get-caller-identity --profile design`
  - [x] Document that both users already have AdministratorAccess policy
- [x] Create S3 Deployment Bucket (AC: 1)
  - [x] Create S3 bucket `security-assistant-sam-deployments` in eu-west-2
  - [x] Configure bucket with versioning enabled
  - [x] Set up lifecycle policy for old deployment artifacts (30 day retention)
  - [x] Apply project tags: `Project=SecurityDesignAssistant`, `ManagedBy=SAM`
- [ ] Investigate GitHub Account Structure (AC: 2)
  - [ ] Access Ric's GitHub account (using provided credentials)
  - [ ] Check if 7Central organization already exists
  - [ ] Review existing repositories and structure
  - [ ] Determine optimal structure:
    - Option A: `RicsAccount/7Central-org/design-assistant-repo`
    - Option B: `RicsAccount/design-assistant-repo` (simple, direct)
    - Option C: `RicsAccount/7Central-org/design-repo/design-assistant-submodule`
  - [ ] Document findings and recommended approach
- [ ] Create GitHub Repository (AC: 2)
  - [ ] Create repository based on chosen structure
  - [ ] Configure repository settings:
    - [ ] Set main as default branch
    - [ ] Enable issues and projects
    - [ ] Configure branch protection for main (require PR reviews)
    - [ ] Add repository description and topics
  - [ ] Create initial README.md with project overview
  - [ ] Add .gitignore for Python projects
  - [ ] Create develop branch for staging deployments
- [ ] Configure Local Development Workflow (AC: 3)
  - [ ] Add Ric's repository as remote origin
  - [ ] Configure git credentials for pushing to Ric's repo
  - [ ] Set up local branches to track remote branches
  - [ ] Test push access with initial commit
  - [ ] Document the dual-account workflow (develop on junksamiad, push to Ric's)
- [x] Test AWS Deployment Setup (AC: 3)
  - [x] Create simple test SAM application
  - [x] Run `sam build` locally
  - [x] Run `sam deploy --profile design-lee` to test permissions
  - [x] Verify resources created in AWS console
  - [x] Clean up test resources
- [x] Create Setup Documentation (AC: 4)
  - [x] Create `docs/setup/aws-setup.md` with:
    - AWS account ID and configuration
    - IAM user and policy details
    - Profile configuration steps
    - Required AWS CLI commands
  - [x] Create `docs/setup/github-setup.md` with:
    - Repository structure explanation
    - Access management approach
    - Branch strategy
    - Development workflow
  - [x] Create `docs/setup/local-development.md` with:
    - Git remote configuration
    - AWS profile setup
    - Testing deployment locally
    - Troubleshooting common issues
  - [x] Update main README.md with setup instructions

## Dev Notes

### Current Situation Context
- **AWS Account**: Existing account (445567098699) in eu-west-2 region, shared by all 7Central businesses
- **Business Structure**: 7Central (group) â†’ Argan, Security Design, Tier8 (businesses)
- **New Profiles Needed**: 
  - `design-lee`: Using existing `lee-hayton` IAM user for local development
  - `design`: Using existing `7c-IAM-Admin-User` for CI/CD deployments
- **Project Namespace**: All resources should be prefixed with `security-assistant-` or tagged with `Project=SecurityDesignAssistant`
- **GitHub Setup**: 
  - Owner: Ric (has provided credentials)
  - Developer: Lee uses `junksamiad` account locally, pushes to Ric's repo
  - Need to investigate best organization structure on Ric's account

### AWS Resources Required [Source: architecture/infrastructure-and-deployment.md]
Based on the infrastructure requirements, the IAM policy needs permissions for:
- S3: Bucket and object operations
- Lambda: Function management
- API Gateway: REST API management
- DynamoDB: Table operations
- CloudFormation: Stack operations (for SAM)
- IAM: Role creation for Lambda execution
- CloudWatch: Logs, metrics, alarms
- SQS: Queue management
- SNS: Topic management
- X-Ray: Tracing (optional)

### S3 Deployment Bucket Requirements [Source: infrastructure/samconfig.toml]
- Bucket name: `security-assistant-sam-deployments`
- Region: `eu-west-2`
- Purpose: Store SAM deployment artifacts
- Versioning: Should be enabled for rollback capability

### GitHub Repository Requirements
Repository needs:
- Main branch (production deployments)
- Develop branch (staging deployments)
- Branch protection rules
- GitHub Actions secrets for AWS credentials:
  - `AWS_ACCESS_KEY_ID`
  - `AWS_SECRET_ACCESS_KEY`
  - `AWS_REGION` (eu-west-2)

### Environment Naming Convention [Source: architecture/infrastructure-and-deployment.md]
- Development: Local only (no AWS)
- Staging: `security-assistant-staging-*`
- Production: `security-assistant-prod-*`

### Testing
**Testing Requirements**:
- Verify AWS CLI profile works: `aws sts get-caller-identity --profile design-lee`
- Test S3 access: `aws s3 ls --profile design-lee`
- Test SAM deployment permissions with minimal template
- Verify GitHub push access from local development environment

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-10 | 1.0 | Initial story draft created | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used
Claude Opus 4.1 (claude-opus-4-1-20250805)

### Debug Log References
N/A - No debug logs generated

### Completion Notes List
- AWS profiles successfully configured (design-lee and design)
- S3 deployment bucket created with proper configuration
- Test deployment successful and cleaned up
- Documentation created for all setup processes
- Region updated from us-east-1 to eu-west-2 based on existing infrastructure
- GitHub setup pending - awaiting access credentials

### File List
- Created: docs/setup/aws-setup.md
- Created: docs/setup/local-development.md  
- Created: docs/setup/github-setup.md
- Modified: docs/stories/3.4.story.md
- Modified: README.md
- Created: test-sam-app/template.yaml (deleted after testing)
- Created: test-sam-app/samconfig.toml (deleted after testing)

## QA Results
_To be filled by QA Agent_